CREATE OR REPLACE TRIGGER CZY_MIEJSCE_SPRZEDANE
BEFORE INSERT ON BILET
FOR EACH ROW
DECLARE
    status NUMBER(4,0);
BEGIN
    SELECT COUNT(ID) AS CZY_ZAJETE 
    INTO status
    FROM BILET 
    WHERE ID_SEANSU = :NEW.ID_SEANSU 
    AND RZAD = :NEW.RZAD
    AND MIEJSCE = :NEW.MIEJSCE;

    IF status > 0 THEN
        RAISE_APPLICATION_ERROR(-20007, 'Nie można sprzedać zajetego miejsca');
    END IF;
END;

